<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://pythonandseo.github.io</id>
    <title>PythonAndSeo</title>
    <updated>2021-12-08T06:51:28.063Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://pythonandseo.github.io"/>
    <link rel="self" href="https://pythonandseo.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://pythonandseo.github.io/images/avatar.png</logo>
    <icon>https://pythonandseo.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, PythonAndSeo</rights>
    <entry>
        <title type="html"><![CDATA[é€šè¿‡bingè·å–æ½œåœ¨å®¢æˆ·ç”µè¯ï¼Œé‚®ç®±]]></title>
        <id>https://pythonandseo.github.io/post/as/</id>
        <link href="https://pythonandseo.github.io/post/as/">
        </link>
        <updated>2021-12-08T03:12:14.000Z</updated>
        <content type="html"><![CDATA[<p>å…¬å¸åšçš„æ˜¯ä¼ æ„Ÿå™¨è¡Œä¸šï¼Œå±äºä¸Šæ¸¸ä¼ä¸šï¼Œä¸‹æ¸¸å¾ˆå¤šç”Ÿäº§å‚å®¶éœ€è¦ç”¨åˆ°ä¼ æ„Ÿå™¨ï¼Œä»¥æ­¤ä¸ºèƒŒæ™¯ï¼Œç¼–å†™çˆ¬è™«å¸®åŠ©å…¬å¸è·å–æ½œåœ¨å®¢æˆ·é‚®ç®±ï¼Œç”µè¯ï¼Œè¿™é‡Œä»¥<strong>CO2 DETECTION</strong>è¿™ä¸ªå…³é”®è¯ä¸ºä¾‹ï¼Œå¦‚éœ€è·å–å…¶ä»–äº§å“ï¼Œåªéœ€è¦æ›´æ¢å…³é”®è¯å³å¯</p>
<h3 id="1æ ¹æ®å…³é”®è¯ç”Ÿæˆbing-base_url">1.æ ¹æ®å…³é”®è¯ç”Ÿæˆbing base_url</h3>
<pre><code class="language-python">import re


def get_bing_url(keywords):
    keywords = keywords.strip('\n')
    bing_url = re.sub(r'^', 'https://www.bing.com/search?q=', keywords)
    bing_url = re.sub(r'\s', '+', bing_url)
    return bing_url


if __name__ == '__main__':
    bing_url = get_bing_url('CO2 DETECTION')
    print(bing_url)

</code></pre>
<h3 id="2æ ¹æ®bingç¿»é¡µè§„åˆ™æ¨¡æ‹Ÿbingç¿»é¡µé“¾æ¥">2.æ ¹æ®bingç¿»é¡µè§„åˆ™ï¼Œæ¨¡æ‹Ÿbingç¿»é¡µé“¾æ¥</h3>
<pre><code class="language-python">bing_url = get_bing_url(keywords.keywords)
    for i in range(1, 100):  # é€šè¿‡for inæ¥ç¿»é¡µ
        print(i)
        time.sleep(random.randint(3, 5))
        if i == 1:
            url = bing_url
        else:
            url = bing_url + '&amp;qs=ds&amp;first=' + str((i * 10) - 1) + '&amp;FORM=PERE'
</code></pre>
<h3 id="3ä½¿ç”¨seleniumæ¨¡æ‹Ÿæ‰“å¼€é“¾æ¥è·å–ç½‘ç«™æºç ">3.ä½¿ç”¨seleniumæ¨¡æ‹Ÿæ‰“å¼€é“¾æ¥ï¼Œè·å–ç½‘ç«™æºç </h3>
<p>æˆ‘è¿™é‡Œç”¨çš„æ˜¯seleniumï¼Œæ¨¡æ‹Ÿæ¸¸è§ˆå™¨æ‰“å¼€ç¿»é¡µï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨requests(è®¿é—®é‡å¤§çš„è¯ï¼Œçˆ¬å–çš„æ•°æ®ç›¸åŒï¼Œæ‰€ä»¥æ›´æ¢selenium)</p>
<pre><code class="language-python">        try:
            browser.set_page_load_timeout(100)  # è®¾ç½®ç½‘é¡µåŠ è½½è¶…æ—¶æ—¶é—´ä¸º20ç§’
            browser.get(url)
            cookie_ = browser.get_cookies()
            # browser.add_cookie(cookie_dict=cookie_)
            html = browser.page_source
        except Exception as e:
            with open('error.txt', 'a', encoding='utf-8') as f:
                f.write(str(e) + '\n')
            pass
</code></pre>
<h3 id="4åˆ©ç”¨xpathè·å–ç½‘ç«™æºç ä»ä¸­æå–url">4.åˆ©ç”¨xpathè·å–ç½‘ç«™æºç ï¼Œä»ä¸­æå–url</h3>
<pre><code class="language-python">tree = etree.HTML(html)
            li_list = tree.xpath('//ol[@id=&quot;b_results&quot;]//li[@class=&quot;b_algo&quot;]')
            for li in li_list:
                try:
                    url_text = li.xpath('./div/a/@href')[0]
                    # print(url_text)
                except Exception as e:
                    with open('url.txt', 'a', encoding='utf-8') as f:
                        f.write(str(e) + url + '\n')
                    pass
                else:
                    domain_pattern = re.compile(r'[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?')
                    domain_text = re.search(r'[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?',url_text).group()
                    print(domain_text)
                    domain = Domain.objects.filter(domain=domain_text).exists()
                    if domain:
                        print('domainå­˜åœ¨:' + url_text)
                        pass
                    else:
                        domain = Domain(domain=domain_text, keywords=keywords)
                        domain.save()
                    pass
</code></pre>
<p>åœ¨è¿™ä¸ªä½¿ç”¨äº†æ­£åˆ™è·å–é“¾æ¥ä¸­åŸŸåï¼Œå› ä¸ºæœ‰å¯èƒ½ä¸€ä¸ªäº§å“æœ‰å¾ˆå¤šä¸åŒçš„é“¾æ¥ï¼Œå‡å°‘å·¥ä½œé‡ï¼Œç›´æ¥ä»¥åŸŸåå»é‡</p>
<h3 id="5å®Œæ•´ä»£ç å¦‚ä¸‹">5.å®Œæ•´ä»£ç å¦‚ä¸‹</h3>
<pre><code class="language-python">import requests
import re
from lxml.html import etree
import os, sys
import django
from workhelp import settings
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
import time
import random

sys.path.append('../../')
os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;workhelp.settings&quot;)
django.setup()
from infomation.models import Domain, KeyWords

chrome_options = Options()
# chrome_options.add_argument('--headless')
chrome_options.add_argument(
    'user-agent=&quot;Mozilla/5.0 (iPod; U; CPU iPhone OS 2_1 like Mac OS X; ja-jp) AppleWebKit/525.18.1 (KHTML, like Gecko) Version/3.1.1 Mobile/5F137 Safari/525.20&quot;')
chrome_options.add_argument('--log-level=3')
browser = webdriver.Chrome(chrome_options=chrome_options)


def get_bing_url(keywords):
    keywords = keywords.strip('\n')
    bing_url = re.sub(r'^', 'https://www.bing.com/search?q=', keywords)
    bing_url = re.sub(r'\s', '+', bing_url)
    return bing_url


keywords_list = KeyWords.objects.all().filter(status=True)
for keywords in keywords_list:
    bing_url = get_bing_url(keywords.keywords)
    for i in range(1, 100):  # é€šè¿‡for inæ¥ç¿»é¡µ
        print(i)
        time.sleep(random.randint(3, 5))
        if i == 1:
            url = bing_url
        else:
            url = bing_url + '&amp;qs=ds&amp;first=' + str((i * 10) - 1) + '&amp;FORM=PERE'
        try:
            browser.set_page_load_timeout(100)  # è®¾ç½®ç½‘é¡µåŠ è½½è¶…æ—¶æ—¶é—´ä¸º20ç§’
            browser.get(url)
            cookie_ = browser.get_cookies()
            # browser.add_cookie(cookie_dict=cookie_)
            html = browser.page_source
        except Exception as e:
            with open('error.txt', 'a', encoding='utf-8') as f:
                f.write(str(e) + '\n')
            pass
        else:
            tree = etree.HTML(html)
            li_list = tree.xpath('//ol[@id=&quot;b_results&quot;]//li[@class=&quot;b_algo&quot;]')
            for li in li_list:
                try:
                    url_text = li.xpath('./div/a/@href')[0]
                    # print(url_text)
                except Exception as e:
                    with open('url.txt', 'a', encoding='utf-8') as f:
                        f.write(str(e) + url + '\n')
                    pass
                else:
                    domain_pattern = re.compile(r'[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?')
                    domain_text = re.search(r'[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?',url_text).group()
                    print(domain_text)
                    domain = Domain.objects.filter(domain=domain_text).exists()
                    if domain:
                        print('domainå­˜åœ¨:' + url_text)
                        pass
                    else:
                        domain = Domain(domain=domain_text, keywords=keywords)
                        domain.save()
                    pass
    keywords.status = False
    keywords.save()

</code></pre>
<p>ç®€å•çš„è¯´ä¸€ä¸‹ä¸Šé¢ä»£ç ï¼Œæˆ‘æ˜¯ä½¿ç”¨djangoæ­å»ºçš„æ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥ä¸djangoæ¨¡å‹è¿›è¡Œäº†ç»“åˆã€‚æœ‰ä¸æ‡‚å¾—å°ä¼™ä¼´å¯ä»¥ç›´æ¥ç•™è¨€ä¸æˆ‘è”ç³»ã€‚</p>
<h3 id="6åŸŸåæå–åˆ°äº†æ¥ä¸‹æ¥å°±æ˜¯æ‰“å¼€é“¾æ¥æŸ¥æ‰¾é‚®ç®±ç”µè¯è¿›è¡Œå¼€å‘äº†">6.åŸŸåæå–åˆ°äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰“å¼€é“¾æ¥ï¼ŒæŸ¥æ‰¾é‚®ç®±ï¼Œç”µè¯ï¼Œè¿›è¡Œå¼€å‘äº†</h3>
<p>ä½œä¸ºä¸€åä¼šå†™ç¨‹åºçš„SEOerï¼Œè‚¯å®šä¸ä¼šè¿™æ ·åšï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œç›´æ¥æ¨¡æ‹Ÿæµè§ˆå™¨æ‰“å¼€ï¼Œè·å–æºç ï¼Œä¿å­˜æ•°æ®åº“ï¼Œå¹¶å°†æ‰“å¼€çš„é¡µé¢æˆªå›¾ï¼Œæ–¹ä¾¿ä¸šåŠ¡äººå‘˜åŒºåˆ†æ˜¯å¦æ˜¯æ½œåœ¨å®¢æˆ·ï¼Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªæ€è·¯ï¼Œæœ‰æ›´å¥½çš„æ–¹æ³•å¯ä»¥ä¸€èµ·æ¢è®¨ï¼Œä»£ç å¦‚ä¸‹</p>
<pre><code class="language-python">import os
import django
import re
import datetime
import uuid
import sys

sys.path.append('../../')
from workhelp import settings
from selenium import webdriver
from selenium.webdriver.chrome.options import Options

os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;workhelp.settings&quot;)
django.setup()


def replaceCharEntity(htmlstr):
    &quot;&quot;&quot;
    æ›¿æ¢å¸¸ç”¨HTMLå­—ç¬¦
    :param htmlstr: è¦æ›¿æ¢çš„å­—ç¬¦
    :return:
    &quot;&quot;&quot;
    CHAR_ENTITIES = {'nbsp': ' ', '160': ' ',
                     'lt': '&lt;', '60': '&lt;',
                     'gt': '&gt;', '62': '&gt;',
                     'amp': '&amp;', '38': '&amp;',
                     'quot': '&quot;', '34': '&quot;', }
    re_charEntity = re.compile(r'&amp;#?(?P&lt;name&gt;\w+);')
    sz = re_charEntity.search(htmlstr)
    while sz:
        entity = sz.group()  # entityå…¨ç§°ï¼Œå¦‚&gt;
        key = sz.group('name')  # å»é™¤&amp;;åentity,å¦‚&gt;ä¸ºgt
        try:
            htmlstr = re_charEntity.sub(CHAR_ENTITIES[key], htmlstr, 1)
            sz = re_charEntity.search(htmlstr)
        except KeyError:
            # ä»¥ç©ºä¸²ä»£æ›¿
            htmlstr = re_charEntity.sub('', htmlstr, 1)
            sz = re_charEntity.search(htmlstr)
    return htmlstr


def filter_tags(htmlstr):
    &quot;&quot;&quot;
    è¿‡æ»¤HTMLä¸­çš„æ ‡ç­¾
    :param htmlstr: è¦è¿‡æ»¤çš„å†…å®¹
    :return:
    &quot;&quot;&quot;
    re_cdata = re.compile('//&lt;!\[CDATA\[[^&gt;]*//\]\]&gt;', re.I)  # åŒ¹é…CDATA
    re_script = re.compile('&lt;\s*script[^&gt;]*&gt;[^&lt;]*&lt;\s*/\s*script\s*&gt;', re.I)  # Script
    re_style = re.compile('&lt;\s*style[^&gt;]*&gt;[^&lt;]*&lt;\s*/\s*style\s*&gt;', re.I)  # style
    re_br = re.compile('&lt;br\s*?/?&gt;')  # å¤„ç†æ¢è¡Œ
    re_h = re.compile('&lt;/?\w+[^&gt;]*&gt;')  # HTMLæ ‡ç­¾
    re_comment = re.compile('&lt;!--[^&gt;]*--&gt;')  # HTMLæ³¨é‡Š
    s = re_cdata.sub('', htmlstr)  # å»æ‰CDATA
    s = re_script.sub('', s)  # å»æ‰SCRIPT
    s = re_style.sub('', s)  # å»æ‰style
    s = re_br.sub('\n', s)  # å°†brè½¬æ¢ä¸ºæ¢è¡Œ
    s = re_h.sub('', s)  # å»æ‰HTML æ ‡ç­¾
    s = re_comment.sub('', s)  # å»æ‰HTMLæ³¨é‡Š
    # å»æ‰å¤šä½™çš„ç©ºè¡Œ
    blank_line = re.compile('\n+')
    s = blank_line.sub(' ', s)
    s = replaceCharEntity(s)  # æ›¿æ¢å®ä½“
    return s


from infomation.models import Domain,Info

while True:
    urls = Domain.objects.all().filter(is_cut=False)[:300]
    print(urls.count())
    chrome_options = Options()
    # chrome_options.add_argument('--headless')
    # chrome_options.add_argument(
    #     'user-agent=&quot;Mozilla/5.0 (iPod; U; CPU iPhone OS 2_1 like Mac OS X; ja-jp) AppleWebKit/525.18.1 (KHTML, like Gecko) Version/3.1.1 Mobile/5F137 Safari/525.20&quot;')
    chrome_options.add_argument('--log-level=3')
    browser = webdriver.Chrome(chrome_options=chrome_options)
    for url in urls:
        print(url.domain)
        pic_path = os.path.join(settings.MEDIA_ROOT, 'images', 'jietu')
        if not os.path.exists(pic_path):
            os.makedirs(pic_path)
        else:
            pass
        try:
            browser.set_page_load_timeout(100)  # è®¾ç½®ç½‘é¡µåŠ è½½è¶…æ—¶æ—¶é—´ä¸º20ç§’
            browser.get('http://'+url.domain)
            html = browser.page_source
            s = filter_tags(html)
            pic_name = '{}.{}'.format(url, '.png')
            browser.get_screenshot_as_file(os.path.join(pic_path, pic_name))

        except Exception as e:
            with open('error.txt', 'a', encoding='utf-8') as f:
                f.write(str(e) + '\n')
            pass
        else:
            pic_path = os.path.join('images', 'jietu', pic_name)
            url = Domain.objects.get(domain=url)
            url.image = pic_path
            url.html = html
            url.content = s
            url.is_cut = True
            url.save()
            # email_pattern = re.compile(r'[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,3}')
            # emails = email_pattern.findall(html)
            # new_emails = list(set(emails))
            # print(new_emails)
            # emails_str = ','.join(new_emails)
            # print(emails_str)
            # info = Info(email=emails_str, url=url)
            # info.save()

    browser.quit()

</code></pre>
<p>æœ€åå°±æ˜¯åˆ©ç”¨æ­£åˆ™ï¼Œæˆ–è€…å…¶ä»–æ–¹æ³•ï¼Œåˆ†ææºç ï¼Œä»ä¸­æå–ä¿¡æ¯</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://pythonandseo.github.io/post/hello-gridea/</id>
        <link href="https://pythonandseo.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>